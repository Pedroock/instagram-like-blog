{% load static %}
<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <title>Instagram â€¢ {% block title %}{% endblock title %}</title>
    <meta name='viewport' content='width=device-width, initial-scale=1'>
    <link rel="stylesheet" href="{% static 'blog/reset.css' %}">
    <link rel="stylesheet" href="{% static 'blog/blog_header_base.css' %}">
    {% block css %}
    {% endblock css %}
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
</head>
<body>
    <header class="blog-header">
        <div>
            <a href="{% url 'home' %}">
                <img class="blog-header-main-logo" src="{% static 'blog/logos/ig-text-logo.png' %}" alt="logo">
            </a>
        </div>
        <input type="text" class="blog-header-searchbar" placeholder="Search for profiles">
        <div class="blog-header-search-popup">
            <div class="blog-header-search-popup-top">
                <h1 class="blog-header-search-popup-top-title">Results</h1>
                <h1 class="blog-header-search-popup-top-close">+</h1>
            </div>
            <div class="blog-header-search-popup-profiles">
                <div class="blog-header-search-popup-profile">
                    <img class="blog-header-search-popup-profile-pfp" src="{{ request.user.profile.pfp.url }}">
                    <h1 class="blog-header-search-popup-profile-username">{{ request.user.username }}</h1>
                </div>
            </div>
        </div>

        <div class="blog-header-buttons">
            <a href="{% url 'home' %}">
                <img class="blog-header-logo" src="{% static 'blog/logos/logo-home.png' %}" alt="home">
            </a>
            <a href="{% url 'direct-index' %}"><img class="blog-header-logo" src="{% static 'blog/logos/logo-direct.png' %}" alt="direct">
            </a>
            {% if home %}
                <a href="" class="header-upload-button">
                    <img class="blog-header-logo" src="{% static 'blog/logos/logo-upload.png' %}" alt="upload">
                </a>
            {% else %}
                <a href="{% url 'home' %}">
                    <img class="blog-header-logo" src="{% static 'blog/logos/logo-upload.png' %}" alt="upload">
                </a>
            {% endif %}
            <a href="{% url 'discover' %}">
                <img class="blog-header-logo" src="{% static 'blog/logos/logo-discover.png' %}" alt="discover">
            </a>
            <a href="">
                <img class="blog-header-logo" src="{% static 'blog/logos/logo-notif.png' %}" alt="notification">
            </a>
            <a href="{% url 'profile' request.user.pk %}">
                <img class="blog-header-pfp" src="{{ request.user.profile.pfp.url }}" alt="profile">
            </a>
        </div>
    </header>
    
    <script>
        $('.blog-header-search-popup-top-close').on('click', function(){
            $('.blog-header-search-popup').css('display', 'none')
            $('.blog-header-searchbar').val('')
        })
        $.getJSON('{% url "profile-query" %}', function(data){
            $('.blog-header-searchbar').keyup(function(){
                var elegibleProfiles = []
                let inputVal = $('.blog-header-searchbar').val()
                // close popup if input == ''
                if(inputVal == ''){
                    $('.blog-header-search-popup').css('display', 'none')
                }else{
                    $('.blog-header-search-popup').css('display', 'block')
                }
                // check val is in usernames
                for(let i = 0; i < data.length; i++){
                    if(data[i].username.includes(inputVal)){
                        elegibleProfiles.push(data[i])
                    }
                }
                // add elegible profiles to the popup
                $('.blog-header-search-popup-profiles').empty()
                for(let i = 0; i < elegibleProfiles.length; i++){
                    pk = elegibleProfiles[i].pk
                    let link = document.createElement('a')
                    link.href = window.location.origin + '/users/profile/' + pk
                    let profileWrapper = document.createElement('div')
                    profileWrapper.classList = "blog-header-search-popup-profile"
                    let pfp = document.createElement('img')
                    pfp.classList = 'blog-header-search-popup-profile-pfp'
                    pfp.src = elegibleProfiles[i].pfp_url
                    let username = document.createElement('h1')
                    username.classList = 'blog-header-search-popup-profile-username'
                    username.innerHTML = elegibleProfiles[i].username
                    profileWrapper.appendChild(pfp)
                    profileWrapper.appendChild(username)
                    link.appendChild(profileWrapper)
                    $('.blog-header-search-popup-profiles').append(link)
                }
            })
        })
    </script>
    
    {% block content %}
    {% endblock content %}
   
    {% block homeside %}
    {% endblock homeside %}

    {% block form %}
    {% endblock form %}

    {% block popup %}
    {% endblock popup %}

    {% block ajax %}
    {% endblock ajax %}
</body>
</html>